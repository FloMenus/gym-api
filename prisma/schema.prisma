generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  ADMIN
}

model User {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  isActive            Boolean           @default(true)
  email               String            @unique
  password            String 
  name                String
  role                UserRole          @default(USER)

  ownedGyms           Gym[]
  challenges          Challenge[]
  participations      ChallengeParticipation[]
  trainingSessions    TrainingSession[]
  userBadges          UserBadge[]
}

enum GymStatus {
  PENDING
  APPROVED
  REJECTED
}

model Gym {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  status              GymStatus         @default(PENDING)
  name                String
  description         String
  capacity            Int
  address             String
  phone               String
  email               String

  ownerId             Int
  owner               User              @relation(fields: [ownerId], references: [id])
  equipments          Equipment[]
}

model Equipment {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  name                String
  quantity            Int?

  gymId               Int
  gym                 Gym               @relation(fields: [gymId], references: [id])
}

model ExerciseType {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  name                String
  description         String?

  challenges          Challenge[]
}

enum ChallengeDifficulty {
  EASY
  MEDIUM
  HARD
}

model Challenge {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  title               String
  description         String?
  duration            Int?
  difficulty          ChallengeDifficulty?

  creatorId           Int
  creator             User              @relation(fields: [creatorId], references: [id])
  exerciseTypes       ExerciseType[]
  participations      ChallengeParticipation[]
}

model ChallengeParticipation {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  startedAt           DateTime          @default(now())
  completedAt         DateTime?
  caloriesBurned      Int?  
  progress            Int? 

  userId              Int
  user                User              @relation(fields: [userId], references: [id])
  challengeId         Int
  challenge           Challenge         @relation(fields: [challengeId], references: [id])
  sessions            TrainingSession[]
}

model TrainingSession {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  date                DateTime          @default(now())
  calories            Int?
  notes               String?

  participationId     Int
  participation       ChallengeParticipation @relation(fields: [participationId], references: [id])
  userId              Int
  user                User              @relation(fields: [userId], references: [id])
}

model Badge {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  name                String
  description         String?
  rule                String? 

  userBadges          UserBadge[]
}

model UserBadge {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  userId              Int
  badgeId             Int
  wonAt               DateTime          @default(now())

  user                User              @relation(fields: [userId], references: [id])
  badge               Badge             @relation(fields: [badgeId], references: [id])
}