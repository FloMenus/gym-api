generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  OWNER
  ADMIN
}

model User {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  isActive            Boolean           @default(true)
  email               String            @unique
  password            String 
  name                String
  role                UserRole          @default(USER)

  ownedGyms           Gym[]
  challenges          Challenge[]
  participations      ChallengeParticipation[]
  trainingSessions    TrainingSession[]
  userBadges          UserBadge[]
  gymRequests         GymRequest[]
}

enum GymStatus {
  PENDING
  APPROVED
  REJECTED
}

enum GymRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

model GymRequest {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  status              GymRequestStatus  @default(PENDING)
  name                String
  description         String
  address             String
  phone               String
  email               String

  ownerId             Int
  owner               User              @relation(fields: [ownerId], references: [id])
}

model Gym {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  status              GymStatus         @default(PENDING)
  name                String
  description         String
  address             String
  phone               String
  email               String

  ownerId             Int
  owner               User              @relation(fields: [ownerId], references: [id])
  trainingRooms       TrainingRoom[]
  challenges          Challenge[]
}

model TrainingRoom {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  name                String
  capacity            Int

  gymId               Int
  gym                 Gym               @relation(fields: [gymId], references: [id])
  exerciseTypeIds     Int[]
  exerciseTypes       ExerciseType[]    @relation("TrainingRoomExerciseTypes")
  equipments          Equipment[]
}

model Equipment {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  name                String
  quantity            Int?

  trainingRoomId      Int
  trainingRoom        TrainingRoom      @relation(fields: [trainingRoomId], references: [id])
}

model ExerciseType {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  name                String
  description         String?
  targetedMuscles     String[]

  challengeExercises  ChallengeExercise[]
  trainingRooms       TrainingRoom[]    @relation("TrainingRoomExerciseTypes")
  records             ExerciseRecord[]
}

enum ChallengeDifficulty {
  EASY
  MEDIUM
  HARD
}

model Challenge {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  title               String
  description         String?
  duration            Int?
  difficulty          ChallengeDifficulty?

  creatorId           Int
  creator             User              @relation(fields: [creatorId], references: [id])
  exercises           ChallengeExercise[]
  participations      ChallengeParticipation[]
  gymId               Int?
  gym                 Gym?              @relation(fields: [gymId], references: [id])
}

model ChallengeParticipation {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  startedAt           DateTime          @default(now())
  completedAt         DateTime?
  caloriesBurned      Int?
  progress            Int?

  userId              Int
  user                User              @relation(fields: [userId], references: [id])
  challengeId         Int
  challenge           Challenge         @relation(fields: [challengeId], references: [id])
  sessions            TrainingSession[]
}

model ChallengeExercise {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  targetReps          Int?
  targetSets          Int?
  targetWeight        Float?
  targetDistance      Float?
  targetDurationSeconds Int?

  challengeId         Int
  challenge           Challenge         @relation(fields: [challengeId], references: [id])
  exerciseTypeId      Int
  exerciseType        ExerciseType      @relation(fields: [exerciseTypeId], references: [id])
}

model TrainingSession {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  date                DateTime          @default(now())
  calories            Int?
  notes               String?

  participationId     Int
  participation       ChallengeParticipation @relation(fields: [participationId], references: [id])
  userId              Int
  user                User              @relation(fields: [userId], references: [id])
  records             ExerciseRecord[]
}

model ExerciseRecord {
  id                  Int               @id @default(autoincrement())
  
  sessionId           Int
  session             TrainingSession   @relation(fields: [sessionId], references: [id])
  
  exerciseTypeId      Int
  exerciseType        ExerciseType      @relation(fields: [exerciseTypeId], references: [id])

  reps                Int?
  sets                Int?
  weight              Float?
  distance            Float?
  durationSeconds     Int?
}

model Badge {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  name                String
  description         String?
  rule                String? 

  userBadges          UserBadge[]
}

model UserBadge {
  id                  Int               @id @default(autoincrement())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  userId              Int
  badgeId             Int
  wonAt               DateTime          @default(now())

  user                User              @relation(fields: [userId], references: [id])
  badge               Badge             @relation(fields: [badgeId], references: [id])
}